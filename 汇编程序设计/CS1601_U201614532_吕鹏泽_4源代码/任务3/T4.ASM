INCLUDE MACRO.LIB
.386
DATA SEGMENT USE16
CMOS_ADDRESS DB ?
MSG1 DB 'input address',0ah,0dh,'$'
DATA ENDS
STACK SEGMENT USE16 STACK
	DB 200 DUP(0)
STACK ENDS
CODE SEGMENT USE16
	ASSUME CS:CODE,DS:DATA,SS:STACK
START:
	MOV AX,DATA
	MOV DS,AX
	
b:	WRITE MSG1
	CALL INPUT
	MOV CMOS_ADDRESS,BL
	CRLF
	MOV AL,CMOS_ADDRESS
	OUT 70H,AL
	IN AL,71H
	CBW
	PUSH AX
	CWDE
	CALL PRINTAX
	CRLF
	POP AX
	MOV BX,0
	MOV BL,AL
	SAR BL,4
	AND BL,0FH
	IMUL BX,10
	AND AL,0FH
	ADD BL,AL
	MOVSX EAX,BL
	CALL PRINTAX
	CRLF
	
	JMP B
EXIT:
	MOV AL,0
	MOV AH,31H
	INT 21H 

	
;------------------------------以X进制输出有符号整数
;EAX——需要输出的数
PRINTAX PROC 
	PUSH EBX
    PUSH CX
	PUSH EDX					;保护现场
	MOV EBX,16
	XOR CX,CX					;计数器清0
	CMP EAX,0
	JNL _LOP1
	NOT EAX
	ADD EAX,1
	PUSH EAX
	OUT1 '-'					;输出负号
	POP EAX
_LOP1:							;(EAX)除以P，所得商->EAX，余数入栈，CX++，记录余数个数
	XOR EDX,EDX
	DIV EBX
	PUSH DX
	INC CX
	OR EAX,EAX
	JNZ _LOP1
_LOP2:							;从栈中弹出一位P进制数，并将该数转换成ASCII码后输出
	POP AX
	CMP AL,10
	JB _L1
	ADD AL,7
_L1:							;输出P进制数
	ADD AL,30H
	MOV DL,AL
	MOV AH,2
	INT 21H
	LOOP _LOP2
	POP EDX
	POP CX						
	POP EBX						;恢复现场
	RET
PRINTAX ENDP
INPUT PROC
	MOV AH,01H
	INT 21H
	CMP AL,'A'
	JGE J3
	CMP AL,'0'
	JGE J1
	
J1:
	CMP AL,'9'
	JLE J2
J2:
	SUB AL,30H
	JMP K5
J3:
	CMP AL,'E'
	JLE J4
J4:
	SUB AL,37H
	
K5:	MOV BL,AL
	SAL BL,4
	
	MOV AH,01H
	INT 21H
	
	CMP AL,'A'
	JGE K3
	CMP AL,'0'
	JGE K1
	
K1:
	CMP AL,'9'
	JLE K2
K2:
	SUB AL,30H
	JMP K6
K3:
	CMP AL,'E'
	JLE K4
K4:
	SUB AL,37H
	
	
K6:	OR BL,AL
	RET 
INPUT ENDP
CODE ENDS
	END START

